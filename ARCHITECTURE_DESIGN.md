# 架构设计方案及依据

## 1. 整体架构概述

本项目采用客户端-服务器（Client-Server）架构模式，将VS Code扩展的UI交互与核心拼写检查逻辑分离，实现了高效、可扩展的拼写检查功能。

```
┌─────────────────────────────────────────────────────────────────┐
│                         VS Code 扩展                            │
├─────────────┬───────────────────────────────────────────────────┤
│  Client     │                   Server                           │
│  (UI层)     ├───────────────────┬───────────────────────────────┤
│             │  核心检查引擎     │  扩展功能模块                 │
│             ├───────────────────┼───────────────────────────────┤
│             │ ┌───────────────┐ │ ┌───────────────┐ ┌─────────┐ │
│             │ │  技术术语库   │ │ │  实时建议生成 │ │ 配置管理│ │
│             │ ├───────────────┤ │ ├───────────────┤ └─────────┘ │
│             │ │  日语检查器   │ │ │  多语言支持   │             │
│             │ ├───────────────┤ │ └───────────────┘             │
│             │ │  拼音检查器   │ │                               │
│             │ └───────────────┘ │                               │
│             └───────────────────┴───────────────────────────────┘
└─────────────────────────────────────────────────────────────────┘
```

## 2. 核心组件设计

### 2.1 Client 层

**功能**：
- 与VS Code API交互，注册扩展命令和事件监听
- 提供用户界面元素，如拼写错误标记、快速修复选项
- 处理用户配置和设置界面

**设计依据**：
- 遵循VS Code扩展开发最佳实践，将UI逻辑与业务逻辑分离
- 采用TypeScript确保类型安全和代码质量
- 使用VS Code的语言服务器协议（LSP）与服务器通信

### 2.2 Server 层

**功能**：
- 处理拼写检查请求
- 管理各种拼写检查器和词典
- 生成拼写建议
- 处理代码操作（如添加到词典、修复拼写错误）

**设计依据**：
- 采用语言服务器模式，提高性能并支持远程开发场景
- 模块化设计，便于扩展和维护
- 使用cspell-lib作为底层拼写检查引擎，保证检查质量

### 2.3 扩展功能模块

#### 2.3.1 技术术语库

**功能**：
- 提供常见技术术语的拼写检查
- 支持动态更新和扩展术语库

**设计依据**：
- 基于开发者的实际需求，技术术语是拼写错误的高发区域
- 使用文本文件存储术语库，便于维护和共享
- 支持多种技术领域的术语（AI、云计算、数据库等）

#### 2.3.2 日语检查器

**功能**：
- 支持日语平假名、片假名和汉字的拼写检查
- 提供日语词汇的正确拼写建议

**设计依据**：
- 满足国际化团队和多语言开发者的需求
- 采用专门的日语拼写检查算法，提高检查准确性

#### 2.3.3 拼音检查器

**功能**：
- 支持中文拼音的拼写检查
- 处理包含拼音的中文名称和术语

**设计依据**：
- 满足双语环境下的拼写检查需求
- 支持拼音与汉字混合使用的场景

#### 2.3.4 实时修复建议

**功能**：
- 为拼写错误提供实时修复建议
- 支持多个拼写错误同时存在时的建议生成

**设计依据**：
- 提高用户体验和工作效率
- 修复了原插件中多个拼写错误时建议功能失效的问题

## 3. 关键技术决策

### 3.1 采用LSP协议

**决策**：使用VS Code的语言服务器协议（LSP）实现客户端-服务器通信

**依据**：
- 分离UI和业务逻辑，提高代码可维护性
- 支持远程开发场景
- 利用VS Code的内置LSP支持，减少开发工作量

### 3.2 扩展cspell-lib功能

**决策**：基于cspell-lib开发，扩展其功能以支持技术术语、日语和拼音检查

**依据**：
- cspell-lib是成熟的拼写检查库，提供了良好的基础功能
- 开源且可扩展，便于添加自定义功能
- 支持自定义词典和配置，满足不同用户需求

### 3.3 模块化设计

**决策**：采用模块化设计，将不同功能封装在独立模块中

**依据**：
- 提高代码复用性和可维护性
- 便于独立测试和调试
- 支持按需加载，提高性能

### 3.4 实时建议优化

**决策**：修改原插件的限制，允许在多个拼写错误同时存在时提供建议

**依据**：
- 原插件的限制影响了用户体验
- 现代IDE用户期望在任何情况下都能获得实时建议
- 技术上可行，只需移除不必要的限制条件

## 4. 扩展性设计

- **插件系统**：支持通过插件扩展拼写检查功能
- **自定义词典**：允许用户添加和管理自定义词典
- **配置灵活性**：提供丰富的配置选项，满足不同用户需求
- **API接口**：暴露API接口，允许其他扩展集成拼写检查功能

## 5. 性能优化

- **缓存机制**：缓存检查结果和配置，减少重复计算
- **增量检查**：只检查修改的内容，提高检查效率
- **异步处理**：使用异步方式处理拼写检查请求，避免阻塞UI
- **按需加载**：只加载必要的检查器和词典，减少内存占用